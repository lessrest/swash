pre-commit:
  parallel: true
  commands:
    fmt:
      run: gofmt -l -w . && git add -u
      skip:
        - merge
        - rebase
    imports:
      run: |
        go run golang.org/x/tools/cmd/goimports@latest -w -local swa.sh/go/swash .
        git add -u
      skip:
        - merge
        - rebase
    tidy:
      run: |
        go mod tidy
        if ! git diff --quiet go.mod go.sum; then
          echo "go.mod/go.sum not tidy - changes staged"
          git add go.mod go.sum
        fi
    vulncheck:
      run: go run golang.org/x/vuln/cmd/govulncheck@latest ./...
    vet:
      run: go vet ./...
    staticcheck:
      run: go run honnef.co/go/tools/cmd/staticcheck@latest ./...
    modernize:
      run: |
        go run golang.org/x/tools/gopls/internal/analysis/modernize/cmd/modernize@latest -fix -test ./...
        if ! git diff --quiet; then
          echo "modernize made changes - review and re-commit"
          exit 1
        fi
    test-unit:
      run: go test ./pkg/... ./internal/...
    test-integration:
      run: make test-integration
